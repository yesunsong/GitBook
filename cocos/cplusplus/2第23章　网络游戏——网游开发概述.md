# 第**23**章　网络游戏——网游开发概述

本章将介绍3种最常见的网游类型，主要目的是作为网游开发的入门指引。如果读者对网游开发一无所知，那么本章可以起到一个不错的“扫盲”效果，如果读者对网游开发只是略知一二，那么本章会让读者对网游开发有进一步的了解。

这里将网游分为3种类型，弱联网、强联网以及局域网游戏，虽然都是网游，但这3种类型的游戏的实现差别较大，而且玩法体验也有明显的区别。

在本章中，我们会在一个实例中贯穿这3种不同的实现。实例的重点是网络而非游戏，所以本章仅是在实例中实现网络功能，并不注重其游戏性。

服务端对于很多没有接触过的人而言是神秘的，本章就来揭开这层神秘的面纱。除了针对3种不同的网游类型进行介绍，本章还会涉及网络编程的基础，以及前后端的设计和实现，网游开发过程中容易碰到的技术问题，并动手实现一个网游的雏形。本章作为网络游戏系列的开篇，会将3种不同类型的网游做个简单介绍，在后面几章中将详细介绍技术实现。本章主要介绍以下内容：

- ![img](https://gitee.com/nlpleaf/PicGo/raw/master/20200621094533.jpeg)　弱联网游戏。
- ![img](https://gitee.com/nlpleaf/PicGo/raw/master/20200621094533.jpeg)　强联网游戏。
- ![img](https://gitee.com/nlpleaf/PicGo/raw/master/20200621094533.jpeg)　局域网游戏。

### 23.1　弱联网游戏

弱联网的游戏类似开心泡泡猫、QQ农场之类的游戏，如图23-1所示。弱联网游戏一般是**基于HTTP协议**，**用PHP，ASP，JSP之类的开发语言编写的Web程序作为服务器**。弱联网游戏实现成本比较低，特别是从页游移植到手机端，一般**使用Libcurl**就可以实现客户端与服务端的通信。一些单机游戏也使用弱联网的方式来实现如公告、每日签到这样的功能。

弱联网一般的实现方式为**短连接**，所谓短连接指的是客户端发起一个请求，服务端响应完就关闭的连接，是一次性的、用完就关闭的连接。例如，打开网页时会建立一个TCP连接，当网页显示完成时，浏览器会关闭这个连接。

有短连接就有对应的长连接，但不论是长连接还是短连接，这里说的主要都是TCP连接，因为UDP是无连接的，千万不要说建立了一个UDP连接，这个说法严格来说是错误的。

另外TCP连接的这个概念并不等同于网络连接，二者是不同层面上的东西，TCP连接是一个虚拟的概念，而网络连接是物理上真实存在的连接，TCP连接不等于网线，这个概念就像初学者容易把硬盘容量与内存卡容量弄混一样——“我的机器有2TB的内存”。TCP连接的建立和关闭是通过三次握手和四次握手，而网线则是插上和拔下。TCP连接对应的是两端的TCP Socket对象，而网线对应的是网卡设备。当然，TCP和UDP都是依赖于底层的网卡网线来传输数据的。

![img](https://gitee.com/nlpleaf/PicGo/raw/master/20200623121358.jpeg)

图23-1　QQ农场

### 23.2　强联网游戏

强联网的游戏一般是比较复杂的网游，如英雄联盟、魔兽世界、大话西游、斗地主这样的游戏，如图23-2所示。强联网一般使用**长连接**，与弱联网的游戏相比最大的区别是是否具有实时交互的功能，例如，一个玩家在走路，其他玩家都可以实时地看到玩家的移动。

![img](https://gitee.com/nlpleaf/PicGo/raw/master/20200623121359.jpeg)

图23-2　英雄联盟

长连接在这里指的是连接建立后一直保持，直到游戏结束或者网络异常连接才会中断，即非一次性的，较长时间保持着的连接。数据的传输是依靠连接进行传输，长连接使我们可以在游戏运行的过程中进行实时通信，不但可以从客户端发送到服务器，也可以由服务器主动推送给客户端，因为只要获取到Socket对象，即可调用send()方法来发送数据。

短连接因为是由客户端发起请求，服务器处理完返回给客户端后，客户端主动关闭，**关闭之后**服务器无法获取到客户端的Socket对象，所以无法主动推送数据到客户端，只能被动地根据客户端的请求来返回数据。长连接和短连接的定义，关键是看连接是否可以一直保持。

### 23.3　局域网游戏

局域网游戏一般也是实时交互的，但该类游戏的特点是**服务器是内嵌在客户端里的**，我们的程序既是客户端又是服务器。例如，红色警戒、魔兽争霸等游戏，都是可以在局域网内与好友对战的游戏，如图23-3所示。这种游戏不需要特别地去架设服务器，每个客户端都可以创建一个**房间**成为服务器。

![img](https://gitee.com/nlpleaf/PicGo/raw/master/20200623121400.jpeg)

图23-3　红色警戒

一般的局域网游戏是TCP和UDP混合使用，可以**用UDP来完成广播**，**搜索房间以及建立房间的功能，用TCP来进行游戏数据的传输**。在局域网内，TCP和UDP一般都能满足游戏需求，但TCP更加稳定，UDP虽然效率略高，但在保证数据传输安全方面需要编写更加复杂的代码来实现，假如是不担心丢包，不严格要求数据包传输顺序的游戏，用UDP会更简单一些。