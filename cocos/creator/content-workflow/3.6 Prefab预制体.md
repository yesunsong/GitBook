# 3.6 预制资源（Prefab）

预制 (Prefab) 是Cocos Creator提出的新概念，针对Cocos Creator可视化编程，以及节点与组件等依附的复杂关系，提供的一种保存与复用方式。

## 3.6.1 创建预制

预制必须是一个节点和其子节点构成的，创建方式如下。

(1) 在场景中创建一个自定义节点，把需要大量复用的内容全部做成该节点的子节点。比如:做一个纯色精灵为背景，黑色文字的标签为内容的节点，如图 3-16所示。

(2) 将 **层级管理器** 中该节点拖曳至 **资源管理器** 内，如图3-17所示。

(3) 形成预制文件，如图3-18所示。

(4) 预制已形成，在创建好预制后，创建的节点已经可以删除了。

![prefab](https://gitee.com/nlpleaf/PicGo/raw/master/cec50e23fd5364646bd80ebb77f51dc6)

![prefab](https://gitee.com/nlpleaf/PicGo/raw/master/7606a6fdbf1d6cd2ac489a2b41fbda3c)

## 3.6.2 预制的实例化

​	预制的实例化是预制的主要使用方式，实例化方式分为编辑器方式与代码方式两种。

​	编辑器方式是将资源管理器中的预制拖曳到层级管理器中或场景编辑器中。场景编 辑器中出现新的预制节点，如图3-19所示。

​	所有预制实例化的节点，称为预制节点。预制节点拥有普通节点所有的特性与功能。此外，预制节点还保持着和预制的关联，可以通过预制节点修改预制也可以将预 制节点还原至预制的初始状态。

​	代码方式详见 4.4.3节



## 3.6.3 修改/保存预制

预制一旦创建，就不能直接修改其内容，只能通过预制节点修改，步骤如下:

(1) 给需要修改的预制实例化一个预制节点; 

(2) 对预制节点按需求进行修改;

(3) 修改完成后，单击预制节点属性检查器中的保存，如图3-20所示;

(4) 预制修改完成后，修改预制所实例化的预制节点就没有用了，可以随时删除。

![apply](https://gitee.com/nlpleaf/PicGo/raw/master/43ce9e99d315960bf01bab5d8b746b4e)



## 3.6.4 还原预制

​	预制的使用除了实例化外，还有很多情况需要实例化后再做属性调整。当调整至不理想状态，希望还原至预制原样的情况时，选中需要还原的预制节点，在属性检查器中 选择“回退”按钮。如图 3-21所示。

![revert](https://gitee.com/nlpleaf/PicGo/raw/master/e2ee138ac2afc9481ee55300e0fbcddd)



## 3.6.5 自动同步和手动同步

每个场景中的预制实例都可以选择要自动同步和还是手动同步。
设为 **手动同步** 时，当预制对应的原始资源被修改后，场景中的预制实例不会同步刷新，只有在用户手动还原预制时才会刷新。
设为 **自动同步** 时，该预制实例会自动和原始资源保持同步。

图中的图标表示当前预制的同步方式，点击图标将会在两种模式之间切换：

![non-syncable](https://gitee.com/nlpleaf/PicGo/raw/master/12afad4b88884881c61f51a8c659d2f0)

上面的图标表示当前预制使用手动同步，点击图标会切换到自动同步：

![auto-syncable](https://gitee.com/nlpleaf/PicGo/raw/master/81d77b297f38e54eeedc14bfb44f48c8)

注意，为了保持引擎的精简，自动同步的预制实例有如下限制：

- 为了便于对各场景实例进行单独定制，场景中的预制根节点自身的 name、active、position 和 rotation 属性不会被自动同步。而其它子节点和所有组件都必须和原始资源保持同步，如果发生修改，编辑器会询问是要撤销修改还是要更新原始资源。
- 自动同步的预制中的组件无法引用该预制外的其它对象，否则编辑器会弹出提示。
- 自动同步的预制外面的组件只能引用该预制的根节点，无法引用组件和子节点，否则编辑器会弹出提示。

> 这些限制都仅影响编辑器操作，运行时不影响。



## 3.6.5 将预制还原成普通节点

从 **资源管理器** 中删除一个预制资源后，你可以将场景中对应的预制实例还原成普通节点。方法是选中预制实例，然后点击菜单 **节点 -> 还原成普通节点**。



## 3.6.6 预制的选项

在 **资源管理器** 中，选中任一预制资源，可以在 **属性检查器** 中编辑以下选项。

### 设置优化策略

优化策略能优化所选预制的实例化时间，也就是执行 `cc.instantiate` 所需的时间。可设置的值有：

- **自动调整**（默认）：

  设为这个选项后，引擎将根据创建次数自动调整优化策略。初次创建实例时，等同于 **优化单次创建性能**，多次创建后将自动 **优化多次创建性能**。

- **优化单次创建性能**：

  该选项会跳过针对这个 prefab 的代码生成优化操作。

- **优化多次创建性能**：

  该选项会启用针对这个 prefab 的代码生成优化操作。

<u>如果这个预制需要反复执行 `cc.instantiate`，请选择 **优化多次创建性能**，否则保持默认的 **自动调整** 即可。</u>

> 在旧版本引擎中，优化方式固定为 **优化多次创建性能**，在需要批量创建对象的场合中效果拔群。但是有不少人将 prefab 作为多人协作或者分步加载的工具，这些 prefab 基本只会实例化一次，就会导致节点创建速度变慢。新版本默认采用 **自动调整** 以后，很好的解决了这个问题。

### 设置延迟加载资源

​	该项默认关闭。勾选之后，使用 **属性检查器** 关联、loadRes 等方式单独加载预制资源时，将会延迟加载预制所依赖的其它资源，提升部分页游的加载速度。详情请参考 [场景的延迟加载](https://docs.cocos.com/creator/manual/zh/asset-workflow/scene-managing.html#async-load-assets)。