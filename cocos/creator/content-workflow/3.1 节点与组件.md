# 3.1 节点与组件

 	Cocos Creator有最重要的两个概念:节点和组件。Cocos Creator摆脱了之前 Cocos2d-x的继承式架构，采用新型组件架构模式。

​	Cocos Creator 的工作流程是以组件式开发为核心的，组件式架构也称作 **组件-实体系统**（或 [Entity-Component System](https://en.wikipedia.org/wiki/Entity_component_system)），简单的说，就是以组合而非继承的方式进行实体的构建。

​	在 Cocos Creator 中，**节点（Node）**是承载组件的实体，我们通过将具有各种功能的 **组件（Component）** 挂载到节点上，来让节点具有各式各样的表现和功能。



## 3.1.1 节点

​	节点 (Node) 是渲染的必要组成部分。所有需要在屏幕中显示的内容都必须是节点或者依附千节点上。节点负责控制显示内容的位置、旋转、缩放、颜色等属性。

​	在层级管理器和场景编辑器中能够看到的所有内容都是节点，选中后可以查看属性检查器，均可查看到 “Node" 部分。 "Node" 部分看起来和其他组件类似，但是不可移除，并永远处于激活状态。如图 3-1所示。

​	节点属性中位置、旋转、缩放等属性，参照 3.2.2节。剩余常见属性如下。

* **铀点 (Anchor)** :铺点是节点位置的参照点，也是自身旋转、缩放的基准点。同时锚点也是该节点子节点的坐标原点。详见3.2节。 X和Y两个成员描述横向和纵向的铺 点位置。取(0, 0)即在节点的左下角，取(1,1)即在节点的右上角，默认为(0.5,0.5)即节点的正中央。

  注意:铀点的取值是可以超过 (0, 0) - (1, 1)的，即铀点并不在节点尺寸范围内。

* **尺寸 (Size)** :本节点的大小，对节点自身没有太多影响，但是会影响节点上的 组件。具体参照各组件，比如常见的精灵组件会根据节点尺寸对渲染图片进行缩放。

* **颜色 (Color) :**节点颜色，影响本节点及其所属组件的渲染，以及其子节点和其 所属组件的渲染。在不透明的情况下，设置节点颜色会直接叠加到节点与所属组件的渲 染效果上，并影响其子节点。

* **透明度 (Opacity)** : 0--255, 0代表完全透明， 255代表完全不透明， 128则大致表 示半透明。会影响本节点及其所属组件的渲染，以及其子节点和其所属组件的渲染。

* **倾斜值 (Skew)** :或者叫倾斜度数，斜向拉伸， 0的效果和 180的效果一致。

* **分组 (Group)** :任意字符串，不可重复。节点分组是为了做属性判断。比如需求 是"友方子弹”分组只和“敌人“做碰撞判断，而不和“友方“做碰撞判断;那么至少 需要拥有“敌人”和“友方”两个分组，并把节点正确的配置分组。



## 3.1.2 创建节点（Node）

​	要最快速的获得一个具有特定功能的节点，可以通过 **层级管理器** 左上角的 **创建节点** 按钮。我们以创建一个最简单的 Sprite（精灵）节点为例，点击 **创建节点** 按钮后选择 `创建渲染节点/Sprite（精灵）`：

![create](https://gitee.com/nlpleaf/PicGo/raw/master/2f7a14ea882ac86496f18dadde5f6499)

​	之后我们就可以在 **场景编辑器** 和 **层级管理器** 中看到新添加的 Sprite 节点了。新节点命名为 `New Sprite`，表示这是一个主要由 Sprite 组件负责提供功能的节点。您也可以尝试再次点击 **创建节点** 按钮，选择其他的节点类型，可以看到它们的命名和表现会有所不同。	

​	这里创建的所有内容都是节点，但只有空节点是单纯的节点，其他选项都是节点与组件的复合体。即创建一个节点，并在上面添加了一些指定组件。



## 3.1.3 子节点

​	每个节点都有自己的父节点 (parent) ，父节点与子节点 (child) 以一对多的方式形成树形结构。最根部的节点以根节点为自己的父节点。通常用户自定义节点都会是画布的子节点或者更深层子节点。

​	子节点的节点属性受父节点的节点属性影响：位置、旋转和缩放均是相对父节点 的锚点为原点的，父节点旋转为正方向，父节点缩放为尺度的坐标系下相对值。具体参照3.2.2节。

​	颜色与透明度等属性则是基千父节点的颜色与透明度进行叠加相乘叠加，比如 子节点的透明度为128约半透明 (0.5) ，其父节点透明度同样为 128约半透明 (0.5), 则子节点的显示效果透明度约为64 (255X0.5X0.5) 。



## 3.1.4 组件（Component）

​	组件是 Cocos Creator的主体构成，渲染(显示内容)、逻辑、用户输入反馈、计 时器等几个方面均是由组件完成的。根据 Cocos Creator的总体架构，组件和节点配合完成游戏所需内容。

​	所有的组件都是脚本(代码 ) 。一部分是 Cocos Creator提供的，源码在 Cocos Creator安装目录中 ， 在编辑器中无法直接查看;一些是用户自定义脚本，可在资源管理器中找到对应的脚本文件。组件脚本需要添加到节点上才能执行。



## 3.1.5 节点与组件的结合

​	以精灵节点为例，在 Cocos Creator提供的 “Hello, w-orld" 案例中，屏幕正中间 的蓝色 ”cocos" 图标就是一个精灵节点。能够正确的将图片显示在屏幕中央主要是靠 两部分内容而生效:节点与精灵组件。

​	选中我们刚才创建的 `New Sprite` 节点，可以看到 **属性检查器** 中的显示：

![Properties](https://gitee.com/nlpleaf/PicGo/raw/master/140b73c248c67c40fe9df2b0a79ed159)

​	**属性检查器** 中以 `Node` 标题开始的部分就是节点的属性，节点属性包括了节点的位置、旋转、缩放、尺寸等变换信息和锚点、颜色、不透明度等其他信息。我们将在 [搭建场景图像](https://docs.cocos.com/creator/manual/zh/content-workflow/scene-editing.html) 部分进行详细介绍。

​	接下来以 `Sprite` 标题开始的部分就是 Sprite 组件的属性，在 2D 游戏中，Sprite 组件负责游戏中绝大部分图像的渲染。Sprite 组件最主要的属性就是 `Sprite Frame`，我们可以在这个属性指定 Sprite 在游戏中渲染的图像文件。让我们试试从 **资源管理器** 中拖拽任意一张图片资源到 **属性检查器** 的 `Sprite Frame` 属性中：

![drag spriteframe](https://gitee.com/nlpleaf/PicGo/raw/master/35e0ec0100b95268055aa03868f59f16)

​	可以看到刚才的默认 Sprite 图片变成了我们指定的图片，这就是 Sprite 组件的作用：渲染图片。

> 组件上设置好的任何资源，如这里的 SpriteFrame，都会在场景加载时自动同时加载好。你也可以在自定义的组件中声明需要设置和自动加载的资源类型，详见 [获取和加载资源](https://docs.cocos.com/creator/manual/zh/scripting/load-assets.html)。

​	Cocos Creator中的脚本组件都要和节点配合才能发挥作用。而 Cocos Creator片 脚本索引也是依照“节点”一“拥有组件”一“脚本具体代码”进行的，具体参『 第 4章。	



### 	节点属性对 Sprite 组件的影响

​	节点和 Sprite 组件进行组合之后，就可以通过修改节点属性来控制图片渲染的方式，您可以按照下图中红线标记属性的设置对您的节点进行调整，可以看到图片的旋转、比例、颜色和不透明度都发生了变化：

![node property](https://gitee.com/nlpleaf/PicGo/raw/master/d17d4088443182f5e533418b906dd139)

我们前面提到了组件式的结构是以组合方式来实现功能的扩展的，下图中就展示了节点和 Sprite 组件的组合。

![node component relationship](https://gitee.com/nlpleaf/PicGo/raw/master/8e5c842bdc6e7bee1ad7c671ddcd5101)



### 节点颜色（Color）和不透明度（Opacity）属性

​	上图中节点的 **颜色（Color）** 属性和 **不透明度（Opacity）** 属性直接影响了 Sprite 组件对图片的渲染。颜色和不透明度同样会影响 [文字（Label）](https://docs.cocos.com/creator/manual/zh/components/label.html) 这样的渲染组件的显示。

​	这两个属性会和渲染组件本身的渲染内容进行相乘，来决定每个像素渲染时的颜色和不透明度。此外不透明度（Opacity）属性还会作用于子节点，可以通过修改父节点的 `Opacity` 轻松实现一组节点内容的淡入淡出效果。



## 3.1.6 添加其他组件

​	在一个节点上可以添加多个组件，来为节点添加更多功能。在上面的例子中，我们可以继续选中 `New Sprite` 这个节点，点击 **属性检查器** 面板下面的 **添加组件** 按钮，选择 **UI 组件 -> Button** 来添加一个 Button（按钮）组件。

​	之后按照下图对 Button 组件的属性进行设置（具体的颜色属性可以根据爱好自由设置）：

![button property](https://gitee.com/nlpleaf/PicGo/raw/master/1f98c56a9aa493ee6403d2911174459e)

接下来点击工具栏上面的 **运行预览** 按钮：

![preview](https://gitee.com/nlpleaf/PicGo/raw/master/df3b6f151586eca272774ad1957840b8)

并在浏览器运行窗口中将鼠标悬停在图片上，可以看到图片的颜色发生变化，也就是我们为节点添加的 Button 组件行为生效了！



## 小结

​	上面的例子里，我们先是将 Sprite 组件和节点组合，有了可以指定渲染图片资源的场景图像，接下来我们通过修改节点属性，能够对这个图像进行缩放和颜色等不同方式的显示。现在我们又为这个节点添加了 Button 组件，让这个节点具有了根据按钮的不同状态（普通、悬停、按下等）的行为。这就是 Cocos Creator 中组件式开发的工作流程，我们可以用这样的方式将不同功能组合在一个节点上，实现如主角的移动攻击控制、背景图像的自动卷动、UI 元素的排版和交互功能等等复杂目标。

​	值得注意的是，**<u>*一个节点上只能添加一个渲染组件*</u>**，渲染组件包括 **Sprite（精灵）**、**Label（文字）**、**Particle（粒子）** 等。



## 参考阅读

- [理解组件-实体系统 - i_dovelemon的博客](http://blog.csdn.net/i_dovelemon/article/details/25798677)

